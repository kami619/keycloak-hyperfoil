name: kc-benchmark2
http:
  host: http://localhost:8080
  sharedConnections: 10
phases:
- steadyState:
    constantRate:
      startAfter: rampUp
      usersPerSec: 1
      duration: 1m
      maxSessions: 2
      scenario: &loginUsernamePassword
          - openLandingPage:
            - randomUUID:
                toVar: uuid
            - set: redirectUri <- localhost:8080/auth/realms/realm-0/account/
            - set: scope <- openid profile
            - httpRequest:
                GET: /auth/realms/realm-0/protocol/openid-connect/auth?login=true&response_type=code&client_id=client-0&state=${uuid}&redirect_uri=${redirectUri}&scope=${scope}
                headers:
                  Accept : text/html,application/xhtml+xml,application/xml
                  Accept-Encoding : gzip, deflate
                  Accept-Language : en-US,en;q=0.5
                  User-Agent : Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:16.0) Gecko/20100101 Firefox/16.0
                handler:
                  status:
                    range: 200
                  body:
                    parseHtml:
                      onTagAttribute:
                        tag: FORM
                        attribute: action
                        toVar: login-form-uri
            # - log: #debug log
            #     message: 'Login Form URI after clean up is ${replace/&amp;/\&/g:login-form-uri}'
          - submitLogin:
            - httpRequest:
                POST: ${replace/&amp;/\&/g:login-form-uri}
                body:
                  form:
                  - name: username
                    value: "user-0"
                  - name: password
                    value: "user-0-password"
                  - name: login
                    pattern: "Log in"
                headers:
                  Accept : text/html,application/xhtml+xml,application/xml
                  Accept-Encoding : gzip, deflate
                  Accept-Language : en-US,en;q=0.5
                  User-Agent : Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:16.0) Gecko/20100101 Firefox/16.0
                handler:
                  status:
                    range: 302

- rampUp:
    increasingRate:
      initialUsersPerSec: 0.1
      targetUsersPerSec: 0.9
      duration: 60s
      scenario: *loginUsernamePassword

# - rampDown:
#     decreasingRate:
#       startAfter: steadyState
#       initialUsersPerSec: 0.1
#       targetUsersPerSec: 0
#       duration: 20s
#       scenario: *openLandingPage